<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å 67 Coin - –§–ò–ù–ê–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: #f0f2f5;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ===== –®–ê–ü–ö–ê ===== */
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.2);
        }

        .balance-display {
            background: rgba(255, 215, 0, 0.2);
            padding: 12px 25px;
            border-radius: 50px;
            border: 2px solid #FFD700;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: bold;
            backdrop-filter: blur(5px);
        }

        .coin-icon {
            font-size: 24px;
        }

        .user-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        #authSection input {
            padding: 10px 15px;
            margin-right: 10px;
            border: none;
            border-radius: 25px;
            background: rgba(255,255,255,0.9);
            font-size: 14px;
        }

        #authSection input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(255,255,255,0.3);
        }

        button {
            background: white;
            color: #667eea;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin-right: 5px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .admin-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5253);
            color: white;
        }

        .role-selector {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }

        .role-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid transparent;
            backdrop-filter: blur(5px);
        }

        .role-btn.active {
            background: white;
            color: #667eea;
            border-color: #fff;
        }

        /* ===== –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ ===== */
        .admin-panel {
            background: linear-gradient(135deg, #ff6b6b20 0%, #ee525320 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #ff6b6b;
            backdrop-filter: blur(5px);
        }

        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .admin-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .admin-card h3 {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #ff6b6b;
            padding-bottom: 10px;
            font-size: 18px;
        }

        .user-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #eee;
            transition: background 0.3s;
        }

        .user-item:hover {
            background: #f8f9fa;
        }

        .ban-badge {
            background: #dc3545;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        /* ===== –ü–ê–ù–ï–õ–¨ –ü–†–û–î–ê–í–¶–ê ===== */
        #sellerPanel {
            background: linear-gradient(135deg, #667eea20 0%, #764ba220 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #667eea;
        }

        /* ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø ===== */
        .main-nav {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .nav-btn {
            padding: 12px 25px;
            background: #f0f2f5;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #333;
            font-weight: 600;
            transition: all 0.3s;
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .badge {
            background: #ff6b6b;
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        /* ===== –ß–ê–¢ ===== */
        .chat-main-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 25px;
            margin-top: 20px;
            height: 650px;
        }

        .dialogs-list {
            background: white;
            border-radius: 15px;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .dialog-item {
            display: flex;
            padding: 20px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: all 0.3s;
        }

        .dialog-item:hover {
            background: #f0f7ff;
        }

        .dialog-item.active {
            background: linear-gradient(135deg, #667eea10, #764ba210);
            border-left: 4px solid #667eea;
        }

        .dialog-avatar {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            margin-right: 15px;
        }

        .dialog-info {
            flex: 1;
        }

        .dialog-name {
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            font-size: 16px;
        }

        .dialog-last-message {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .dialog-time {
            font-size: 12px;
            color: #999;
        }

        .unread-badge {
            background: #ff6b6b;
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .chat-window {
            background: white;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            height: 650px;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px 25px;
            border-radius: 15px 15px 0 0;
            font-size: 18px;
            font-weight: 600;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            display: flex;
            flex-direction: column;
            max-width: 70%;
        }

        .message.sent {
            align-self: flex-end;
        }

        .message.received {
            align-self: flex-start;
        }

        .message-content {
            padding: 12px 20px;
            border-radius: 20px;
            position: relative;
            word-wrap: break-word;
            font-size: 14px;
            line-height: 1.5;
        }

        .message.sent .message-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.received .message-content {
            background: white;
            color: #333;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .message-time {
            font-size: 11px;
            color: #999;
            margin-top: 5px;
            margin-left: 10px;
        }

        .chat-input-area {
            display: flex;
            padding: 20px 25px;
            background: white;
            border-top: 1px solid #eee;
            border-radius: 0 0 15px 15px;
            gap: 15px;
        }

        .chat-input-area input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #eee;
            border-radius: 25px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .chat-input-area input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }

        .chat-input-area button {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 25px;
            margin: 0;
        }

        .chat-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #999;
            font-size: 18px;
            gap: 20px;
        }

        /* ===== –¢–û–í–ê–†–´ ===== */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .product-card {
            border: 1px solid #eee;
            padding: 20px;
            border-radius: 15px;
            background: white;
            transition: all 0.3s;
            position: relative;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102,126,234,0.15);
        }

        .product-image {
            width: 100%;
            height: 220px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .category-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(102, 126, 234, 0.95);
            color: white;
            padding: 6px 15px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 600;
            backdrop-filter: blur(5px);
        }

        .price {
            font-size: 26px;
            color: #667eea;
            font-weight: bold;
            margin: 15px 0;
        }

        .contact-seller-btn {
            background: #ffc107;
            color: #333;
            width: 100%;
            margin-top: 15px;
            padding: 12px;
            border-radius: 10px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .contact-seller-btn:hover {
            background: #ffca2c;
            transform: translateY(-2px);
        }

        /* ===== –ê–ù–ò–ú–ê–¶–ò–ò ===== */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            animation: slideIn 0.3s;
            z-index: 1001;
            box-shadow: 0 10px 20px rgba(40,167,69,0.2);
        }

        /* ===== –ê–î–ê–ü–¢–ê–¶–ò–Ø ===== */
        @media (max-width: 768px) {
            .chat-main-container {
                grid-template-columns: 1fr;
            }
            
            .product-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ===== –®–ê–ü–ö–ê ===== -->
        <header>
            <div style="display: flex; align-items: center; gap: 20px;">
                <h1>üõçÔ∏è –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å 67 Coin</h1>
            </div>
            <div class="user-controls">
                <div id="authSection">
                    <div id="loginForm">
                        <input type="text" id="username" placeholder="–õ–æ–≥–∏–Ω" value="ultra67turbo">
                        <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" value="67govYhs">
                        <button onclick="login()">–í–æ–π—Ç–∏</button>
                        <button onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                    </div>
                    <div id="userInfo" style="display: none;">
                        <span id="currentUser"></span>
                        <div id="balanceDisplay" class="balance-display" style="display: none;">
                            <span class="coin-icon">ü™ô</span>
                            <span id="userBalance">0</span> 67 Coin
                        </div>
                        <div class="role-selector">
                            <button class="role-btn" onclick="setRole('buyer')">–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</button>
                            <button class="role-btn" onclick="setRole('seller')">–ü—Ä–æ–¥–∞–≤–µ—Ü</button>
                            <button class="role-btn admin-btn" id="adminRoleBtn" style="display: none;" onclick="setRole('admin')">–ê–¥–º–∏–Ω</button>
                        </div>
                        <button onclick="logout()">–í—ã–π—Ç–∏</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- ===== –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ ===== -->
        <div id="adminPanel" style="display: none;">
            <div class="admin-panel">
                <h2 style="color: #ff6b6b;">üëë –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h2>
                <div class="admin-grid">
                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ -->
                    <div class="admin-card">
                        <h3>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
                        <div class="user-list" id="userList"></div>
                    </div>
                    
                    <!-- –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã -->
                    <div class="admin-card">
                        <h3>ü™ô –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ 67 Coin</h3>
                        <select id="coinUserSelect" style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 10px;">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>
                        </select>
                        <input type="number" id="coinAmount" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ 67 Coin" min="1" style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 10px;">
                        <input type="text" id="coinReason" placeholder="–ü—Ä–∏—á–∏–Ω–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è" style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 10px;">
                        <button onclick="addCoins()" style="width: 100%; background: #FFD700; color: #000; padding: 12px;">–ù–∞—á–∏—Å–ª–∏—Ç—å 67 Coin</button>
                    </div>
                    
                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏ -->
                    <div class="admin-card">
                        <h3>üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h3>
                        <select id="adminProductSelect" style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 10px;">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä</option>
                        </select>
                        <input type="number" id="newPrice" placeholder="–ù–æ–≤–∞—è —Ü–µ–Ω–∞ 67 Coin" style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 10px;">
                        <button onclick="changeProductPrice()" style="width: 100%; margin-bottom: 10px; background: #667eea; color: white; padding: 12px;">–ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É</button>
                        <button onclick="deleteProductAdmin()" style="width: 100%; background: #dc3545; color: white; padding: 12px;">–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
                    </div>
                    
                    <!-- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω–æ–≤ -->
                    <div class="admin-card">
                        <h3>üëë –ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
                        <select id="adminUserSelect" style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 10px;">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>
                        </select>
                        <button onclick="makeAdmin()" style="width: 100%; background: linear-gradient(135deg, #ff6b6b, #ee5253); color: white; padding: 12px;">–°–¥–µ–ª–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== –ü–ê–ù–ï–õ–¨ –ü–†–û–î–ê–í–¶–ê ===== -->
        <div id="sellerPanel" style="display: none;">
            <h2 style="margin-bottom: 20px;">üì¶ –ü–∞–Ω–µ–ª—å –ø—Ä–æ–¥–∞–≤—Ü–∞</h2>
            <div style="background: white; padding: 25px; border-radius: 15px;">
                <input type="text" id="productName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 10px;">
                <textarea id="productDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 10px;" rows="4"></textarea>
                <input type="number" id="productPrice" placeholder="–¶–µ–Ω–∞ –≤ 67 Coin" style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 10px;" min="1">
                <input type="number" id="productStock" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ" style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 10px;" min="1" value="1">
                <select id="productCategory" style="width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 10px;">
                    <option value="electronics">üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</option>
                    <option value="clothing">üëï –û–¥–µ–∂–¥–∞</option>
                    <option value="home">üè† –î–æ–º –∏ —Å–∞–¥</option>
                    <option value="sports">‚öΩ –°–ø–æ—Ä—Ç</option>
                    <option value="books">üìö –ö–Ω–∏–≥–∏</option>
                    <option value="other">üì¶ –î—Ä—É–≥–æ–µ</option>
                </select>
                <button onclick="addProduct()" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer;">‚ûï –í—ã–ª–æ–∂–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
            </div>
        </div>

        <!-- ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø ===== -->
        <div class="main-nav">
            <button class="nav-btn active" onclick="showPage('market')">
                üè† –¢–æ–≤–∞—Ä—ã
            </button>
            <button class="nav-btn" onclick="showPage('chats')">
                üí¨ –°–æ–æ–±—â–µ–Ω–∏—è
                <span class="badge" id="unreadBadge">0</span>
            </button>
        </div>

        <!-- ===== –°–¢–†–ê–ù–ò–¶–ê –¢–û–í–ê–†–û–í ===== -->
        <div id="marketPage">
            <div id="productList" class="product-grid"></div>
        </div>

        <!-- ===== –°–¢–†–ê–ù–ò–¶–ê –ß–ê–¢–û–í ===== -->
        <div id="chatsPage" style="display: none;">
            <div class="chat-main-container">
                <!-- –°–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤ -->
                <div class="dialogs-list" id="dialogsList"></div>
                
                <!-- –ê–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç -->
                <div class="chat-window" id="activeChatWindow">
                    <div class="chat-header" id="chatHeader">
                        <span id="chatWith">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</span>
                    </div>
                    <div class="chat-messages" id="chatMessages"></div>
                    <div class="chat-input-area" id="chatInputArea" style="display: none;">
                        <input type="text" id="messageInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key === 'Enter') sendMessage()">
                        <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                    </div>
                    <div id="chatPlaceholder" class="chat-placeholder">
                        <div style="font-size: 64px;">üí¨</div>
                        <div style="font-size: 20px;">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∏–∞–ª–æ–≥</div>
                        <div style="color: #999;">–ù–∞–∂–º–∏—Ç–µ "–ù–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ–¥–∞–≤—Ü—É" –Ω–∞ —Ç–æ–≤–∞—Ä–µ</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" style="display: none;" class="notification"></div>

    <script>
        // ============================================
        // –§–ò–ù–ê–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø –ú–ê–†–ö–ï–¢–ü–õ–ï–ô–°–ê 67 COIN
        // –ê–î–ú–ò–ù: ultra67turbo / 67govYhs
        // ============================================

        // ===== –•–†–ê–ù–ò–õ–ò–©–ï –î–ê–ù–ù–´–• =====
        let users = JSON.parse(localStorage.getItem('users')) || [];
        let products = JSON.parse(localStorage.getItem('products')) || [];
        let orders = JSON.parse(localStorage.getItem('orders')) || [];
        let messages = JSON.parse(localStorage.getItem('messages')) || {};
        let currentUser = null;
        let currentRole = 'buyer';
        let currentChatUser = null;

        // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
        function initData() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞...');
            
            // –°–û–ó–î–ê–ï–ú –ê–î–ú–ò–ù–ê ultra67turbo
            const adminExists = users.find(u => u.username === 'ultra67turbo');
            if (!adminExists) {
                const admin = {
                    id: 999999,
                    username: 'ultra67turbo',
                    password: '67govYhs',
                    isAdmin: true,
                    role: 'admin',
                    balance: 100000,
                    registered: new Date().toLocaleString(),
                    banned: false
                };
                users.push(admin);
                console.log('‚úÖ –ê–¥–º–∏–Ω ultra67turbo —Å–æ–∑–¥–∞–Ω!');
            }

            // –ü–†–û–í–ï–†–Ø–ï–ú –ò –û–ë–ù–û–í–õ–Ø–ï–ú –ê–î–ú–ò–ù–ê
            users.forEach(user => {
                if (user.username === 'ultra67turbo') {
                    user.isAdmin = true;
                    user.role = 'admin';
                    user.password = '67govYhs';
                    user.balance = 100000;
                }
            });

            // –°–û–ó–î–ê–ï–ú –ü–†–û–î–ê–í–¶–ê
            if (!users.find(u => u.username === 'seller')) {
                users.push({
                    id: 2,
                    username: 'seller',
                    password: '123',
                    isAdmin: false,
                    role: 'user',
                    balance: 5000,
                    registered: new Date().toLocaleString(),
                    banned: false
                });
            }

            // –°–û–ó–î–ê–ï–ú –ü–û–ö–£–ü–ê–¢–ï–õ–Ø
            if (!users.find(u => u.username === 'buyer')) {
                users.push({
                    id: 3,
                    username: 'buyer',
                    password: '123',
                    isAdmin: false,
                    role: 'user',
                    balance: 3000,
                    registered: new Date().toLocaleString(),
                    banned: false
                });
            }

            // –°–û–ó–î–ê–ï–ú –¢–ï–°–¢–û–í–´–ï –¢–û–í–ê–†–´
            if (products.length === 0) {
                products.push({
                    id: 1,
                    name: 'iPhone 13 Pro Max',
                    description: '–§–ª–∞–≥–º–∞–Ω—Å–∫–∏–π —Å–º–∞—Ä—Ç—Ñ–æ–Ω Apple, 256GB, Sierra Blue, –æ—Ä–∏–≥–∏–Ω–∞–ª',
                    price: 750,
                    stock: 5,
                    category: 'electronics',
                    seller: 'seller',
                    sellerId: 2,
                    date: new Date().toLocaleString(),
                    views: 245,
                    purchases: 12
                });
                
                products.push({
                    id: 2,
                    name: '–ù–æ—É—Ç–±—É–∫ ASUS ROG Strix',
                    description: '–ò–≥—Ä–æ–≤–æ–π –Ω–æ—É—Ç–±—É–∫, Intel Core i7, RTX 3070, 16GB RAM, 512GB SSD',
                    price: 1200,
                    stock: 3,
                    category: 'electronics',
                    seller: 'seller',
                    sellerId: 2,
                    date: new Date().toLocaleString(),
                    views: 189,
                    purchases: 7
                });
                
                products.push({
                    id: 3,
                    name: '–ö—Ä–æ—Å—Å–æ–≤–∫–∏ Nike Air Max',
                    description: '–û—Ä–∏–≥–∏–Ω–∞–ª, —Ä–∞–∑–º–µ—Ä 42-45, —Ü–≤–µ—Ç —á–µ—Ä–Ω—ã–π/–±–µ–ª—ã–π',
                    price: 120,
                    stock: 15,
                    category: 'clothing',
                    seller: 'seller',
                    sellerId: 2,
                    date: new Date().toLocaleString(),
                    views: 567,
                    purchases: 34
                });
            }

            // –°–û–ó–î–ê–ï–ú –¢–ï–°–¢–û–í–´–ï –°–û–û–ë–©–ï–ù–ò–Ø
            const chatId = getChatId(2, 3);
            if (!messages[chatId]) {
                messages[chatId] = [
                    {
                        id: 1,
                        from: 2,
                        to: 3,
                        text: '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –¢–æ–≤–∞—Ä –≤ –Ω–∞–ª–∏—á–∏–∏, –º–æ–≥—É —Å–¥–µ–ª–∞—Ç—å —Å–∫–∏–¥–∫—É 10%',
                        time: new Date().toLocaleString(),
                        read: true
                    },
                    {
                        id: 2,
                        from: 3,
                        to: 2,
                        text: '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –û—Ç–ª–∏—á–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, –æ—Ñ–æ—Ä–º–ª—é –∑–∞–∫–∞–∑',
                        time: new Date().toLocaleString(),
                        read: false
                    }
                ];
            }

            // –°–û–•–†–ê–ù–Ø–ï–ú –í–°–ï –í LOCALSTORAGE
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('products', JSON.stringify(products));
            localStorage.setItem('messages', JSON.stringify(messages));
            localStorage.setItem('orders', JSON.stringify(orders));

            console.log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!');
            console.log('üëë –ê–¥–º–∏–Ω: ultra67turbo / 67govYhs');
        }

        initData();

        // ===== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø =====
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // ===== –ü–†–û–í–ï–†–ö–ê –ê–î–ú–ò–ù–ê =====
        function isAdmin() {
            return currentUser && (currentUser.username === 'ultra67turbo' || currentUser.isAdmin === true);
        }

        // ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–ò =====
        function updateAdminPanel() {
            if (!isAdmin()) return;
            
            // –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            const userList = document.getElementById('userList');
            userList.innerHTML = users.map(user => `
                <div class="user-item">
                    <div>
                        <strong>${user.username}</strong>
                        ${user.username === 'ultra67turbo' ? ' üëë' : ''}
                        ${user.banned ? '<span class="ban-badge">–ó–∞–±–∞–Ω–µ–Ω</span>' : ''}
                        <div style="color: #666; font-size: 12px;">–ë–∞–ª–∞–Ω—Å: ü™ô ${user.balance || 0}</div>
                    </div>
                    <div>
                        ${user.username !== 'ultra67turbo' ? `
                            <button onclick="banUser(${user.id})" style="background: #dc3545; color: white; padding: 5px 10px; font-size: 12px;">
                                ${user.banned ? '–†–∞–∑–±–∞–Ω–∏—Ç—å' : '–ó–∞–±–∞–Ω–∏—Ç—å'}
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');

            // –°–µ–ª–µ–∫—Ç –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –º–æ–Ω–µ—Ç
            const coinUserSelect = document.getElementById('coinUserSelect');
            coinUserSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>' + 
                users.filter(u => !u.banned).map(u => 
                    `<option value="${u.id}">${u.username} (${u.balance || 0} 67 Coin)</option>`
                ).join('');

            // –°–µ–ª–µ–∫—Ç –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∞–¥–º–∏–Ω–æ–≤
            const adminUserSelect = document.getElementById('adminUserSelect');
            adminUserSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>' + 
                users.filter(u => !u.isAdmin && u.username !== 'ultra67turbo' && !u.banned).map(u => 
                    `<option value="${u.id}">${u.username}</option>`
                ).join('');

            // –°–µ–ª–µ–∫—Ç –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
            const adminProductSelect = document.getElementById('adminProductSelect');
            adminProductSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä</option>' + 
                products.map(p => `<option value="${p.id}">${p.name} - ${p.price} 67 Coin</option>`).join('');
        }

        // ===== –ê–î–ú–ò–ù –§–£–ù–ö–¶–ò–ò =====
        function banUser(userId) {
            const user = users.find(u => u.id === userId);
            if (user) {
                user.banned = !user.banned;
                localStorage.setItem('users', JSON.stringify(users));
                updateAdminPanel();
                showNotification(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${user.username} ${user.banned ? '–∑–∞–±–∞–Ω–µ–Ω' : '—Ä–∞–∑–±–∞–Ω–µ–Ω'}`);
            }
        }

        function addCoins() {
            const userId = parseInt(document.getElementById('coinUserSelect').value);
            const amount = parseInt(document.getElementById('coinAmount').value);
            const reason = document.getElementById('coinReason').value;
            
            if (!userId || !amount || amount <= 0) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —É–∫–∞–∂–∏—Ç–µ —Å—É–º–º—É!');
                return;
            }
            
            const user = users.find(u => u.id === userId);
            if (user) {
                user.balance = (user.balance || 0) + amount;
                localStorage.setItem('users', JSON.stringify(users));
                
                if (currentUser && currentUser.id === user.id) {
                    document.getElementById('userBalance').textContent = user.balance;
                }
                
                updateAdminPanel();
                document.getElementById('coinAmount').value = '';
                document.getElementById('coinReason').value = '';
                
                showNotification(`‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–æ ${amount} 67 Coin –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${user.username}`);
            }
        }

        function makeAdmin() {
            const userId = parseInt(document.getElementById('adminUserSelect').value);
            if (!userId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!');
                return;
            }
            
            const user = users.find(u => u.id === userId);
            if (user) {
                user.isAdmin = true;
                user.role = 'admin';
                localStorage.setItem('users', JSON.stringify(users));
                updateAdminPanel();
                showNotification(`üëë –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${user.username} –Ω–∞–∑–Ω–∞—á–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!`);
            }
        }

        function changeProductPrice() {
            const productId = parseInt(document.getElementById('adminProductSelect').value);
            const newPrice = parseInt(document.getElementById('newPrice').value);
            
            if (!productId || !newPrice || newPrice <= 0) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –∏ —É–∫–∞–∂–∏—Ç–µ –Ω–æ–≤—É—é —Ü–µ–Ω—É!');
                return;
            }
            
            const product = products.find(p => p.id === productId);
            if (product) {
                product.price = newPrice;
                localStorage.setItem('products', JSON.stringify(products));
                updateAdminPanel();
                displayProducts();
                showNotification(`üí∞ –¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞ "${product.name}" –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ ${newPrice} 67 Coin`);
                document.getElementById('newPrice').value = '';
            }
        }

        function deleteProductAdmin() {
            const productId = parseInt(document.getElementById('adminProductSelect').value);
            
            if (!productId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä!');
                return;
            }
            
            const product = products.find(p => p.id === productId);
            if (product && confirm(`–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä "${product.name}"?`)) {
                products = products.filter(p => p.id !== productId);
                localStorage.setItem('products', JSON.stringify(products));
                updateAdminPanel();
                displayProducts();
                showNotification(`üóëÔ∏è –¢–æ–≤–∞—Ä "${product.name}" —É–¥–∞–ª–µ–Ω`);
            }
        }

        // ===== –¢–û–í–ê–†–´ =====
        function displayProducts() {
            const list = document.getElementById('productList');
            if (!list) return;
            
            if (products.length === 0) {
                list.innerHTML = '<p style="text-align: center; padding: 50px; grid-column: 1/-1;">üì¶ –¢–æ–≤–∞—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>';
                return;
            }

            const categoryNames = {
                'electronics': 'üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞',
                'clothing': 'üëï –û–¥–µ–∂–¥–∞',
                'home': 'üè† –î–æ–º –∏ —Å–∞–¥',
                'sports': '‚öΩ –°–ø–æ—Ä—Ç',
                'books': 'üìö –ö–Ω–∏–≥–∏',
                'other': 'üì¶ –î—Ä—É–≥–æ–µ'
            };
            
            let html = '';
            products.forEach(p => {
                html += `
                    <div class="product-card">
                        <span class="category-badge">${categoryNames[p.category] || p.category}</span>
                        <img src="https://via.placeholder.com/300x200/667eea/ffffff?text=${p.name.replace(/ /g, '+')}" class="product-image">
                        <h3 style="margin-bottom: 10px;">${p.name}</h3>
                        <p style="color: #666; margin-bottom: 15px;">${p.description}</p>
                        <div class="price">${p.price} 67 Coin</div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 15px; color: #666;">
                            <span>üì¶ –í –Ω–∞–ª–∏—á–∏–∏: ${p.stock} —à—Ç.</span>
                            <span>üëÅÔ∏è ${p.views || 0}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #666;">–ü—Ä–æ–¥–∞–≤–µ—Ü: ${p.seller}</span>
                        </div>
                        ${currentUser ? `
                            <button class="contact-seller-btn" onclick="openChatWithSeller(${p.sellerId}, '${p.seller}')">
                                üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ–¥–∞–≤—Ü—É
                            </button>
                        ` : ''}
                    </div>
                `;
            });
            
            list.innerHTML = html;
        }

        // ===== –î–û–ë–ê–í–õ–ï–ù–ò–ï –¢–û–í–ê–†–ê =====
        function addProduct() {
            if (!currentUser) {
                alert('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É!');
                return;
            }

            if (currentRole !== 'seller') {
                alert('‚ùå –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ —Ä–æ–ª—å –ø—Ä–æ–¥–∞–≤—Ü–∞!');
                return;
            }

            const name = document.getElementById('productName').value.trim();
            const desc = document.getElementById('productDesc').value.trim();
            const price = parseInt(document.getElementById('productPrice').value);
            const stock = parseInt(document.getElementById('productStock').value);
            const category = document.getElementById('productCategory').value;
            
            if (!name || !desc || !price || !stock || !category) {
                alert('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }
            
            const product = {
                id: Date.now(),
                name: name,
                description: desc,
                price: price,
                stock: stock,
                category: category,
                seller: currentUser.username,
                sellerId: currentUser.id,
                date: new Date().toLocaleString(),
                views: 0,
                purchases: 0
            };
            
            products.push(product);
            localStorage.setItem('products', JSON.stringify(products));
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('productName').value = '';
            document.getElementById('productDesc').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productStock').value = '1';
            
            displayProducts();
            showNotification(`‚úÖ –¢–æ–≤–∞—Ä "${name}" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!`);
        }

        // ===== –ß–ê–¢–´ =====
        function getChatId(user1, user2) {
            return [user1, user2].sort((a,b) => a - b).join('_');
        }

        function openChatWithSeller(sellerId, sellerName) {
            if (!currentUser) {
                alert('‚ùå –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            currentChatUser = { id: sellerId, name: sellerName };
            showPage('chats');
            loadDialogs();
            loadChat(sellerId);
        }

        function loadDialogs() {
            if (!currentUser) return;
            
            const dialogsList = document.getElementById('dialogsList');
            if (!dialogsList) return;
            
            const userDialogs = new Set();
            
            Object.keys(messages).forEach(key => {
                const [id1, id2] = key.split('_').map(Number);
                if (id1 === currentUser.id || id2 === currentUser.id) {
                    const otherId = id1 === currentUser.id ? id2 : id1;
                    userDialogs.add(otherId);
                }
            });
            
            if (userDialogs.size === 0) {
                dialogsList.innerHTML = '<div style="padding: 30px; text-align: center;">üí¨ –ù–µ—Ç –¥–∏–∞–ª–æ–≥–æ–≤<br><span style="color: #999; font-size: 14px;">–ù–∞–ø–∏—à–∏—Ç–µ –ø—Ä–æ–¥–∞–≤—Ü—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞</span></div>';
                return;
            }
            
            let html = '';
            userDialogs.forEach(otherId => {
                const otherUser = users.find(u => u.id === otherId) || { username: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å' };
                const chatId = getChatId(currentUser.id, otherId);
                const dialogMessages = messages[chatId] || [];
                const lastMsg = dialogMessages[dialogMessages.length - 1];
                const unread = dialogMessages.filter(m => m.to === currentUser.id && !m.read).length;
                
                html += `
                    <div class="dialog-item ${currentChatUser?.id === otherId ? 'active' : ''}" onclick="loadChat(${otherId})">
                        <div class="dialog-avatar">${otherUser.username[0].toUpperCase()}</div>
                        <div class="dialog-info">
                            <div class="dialog-name">
                                <span>${otherUser.username} ${otherUser.isAdmin ? 'üëë' : ''}</span>
                                ${unread > 0 ? `<span class="unread-badge">${unread}</span>` : ''}
                            </div>
                            <div class="dialog-last-message">
                                ${lastMsg ? lastMsg.text.substring(0, 40) + (lastMsg.text.length > 40 ? '...' : '') : '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π'}
                            </div>
                            <div class="dialog-time">${lastMsg ? lastMsg.time : ''}</div>
                        </div>
                    </div>
                `;
            });
            
            dialogsList.innerHTML = html;
            updateUnreadBadge();
        }

        function loadChat(userId) {
            const otherUser = users.find(u => u.id === userId);
            if (!otherUser) return;
            
            currentChatUser = { id: userId, name: otherUser.username };
            
            document.getElementById('chatWith').textContent = `–ß–∞—Ç —Å ${otherUser.username} ${otherUser.isAdmin ? 'üëë' : ''}`;
            document.getElementById('chatInputArea').style.display = 'flex';
            document.getElementById('chatPlaceholder').style.display = 'none';
            
            const chatId = getChatId(currentUser.id, userId);
            const chatMessages = messages[chatId] || [];
            
            // –û—Ç–º–µ—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
            if (messages[chatId]) {
                messages[chatId].forEach(m => {
                    if (m.to === currentUser.id) m.read = true;
                });
                localStorage.setItem('messages', JSON.stringify(messages));
            }
            
            const messagesContainer = document.getElementById('chatMessages');
            let html = '';
            
            chatMessages.forEach(msg => {
                const isSent = msg.from === currentUser.id;
                html += `
                    <div class="message ${isSent ? 'sent' : 'received'}">
                        <div class="message-content">${msg.text}</div>
                        <div class="message-time">${msg.time}</div>
                    </div>
                `;
            });
            
            messagesContainer.innerHTML = html;
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            loadDialogs();
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text || !currentUser || !currentChatUser) return;
            
            const chatId = getChatId(currentUser.id, currentChatUser.id);
            
            if (!messages[chatId]) {
                messages[chatId] = [];
            }
            
            const message = {
                id: Date.now(),
                from: currentUser.id,
                to: currentChatUser.id,
                text: text,
                time: new Date().toLocaleString(),
                read: false
            };
            
            messages[chatId].push(message);
            localStorage.setItem('messages', JSON.stringify(messages));
            
            input.value = '';
            loadChat(currentChatUser.id);
            showNotification('‚úâÔ∏è –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
        }

        function updateUnreadBadge() {
            const badge = document.getElementById('unreadBadge');
            if (!currentUser) {
                badge.style.display = 'none';
                return;
            }
            
            let unread = 0;
            Object.keys(messages).forEach(key => {
                const [id1, id2] = key.split('_').map(Number);
                if (id1 === currentUser.id || id2 === currentUser.id) {
                    messages[key].forEach(m => {
                        if (m.to === currentUser.id && !m.read) unread++;
                    });
                }
            });
            
            badge.textContent = unread;
            badge.style.display = unread > 0 ? 'inline-block' : 'none';
        }

        // ===== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø =====
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                if (user.banned) {
                    alert('‚ùå –≠—Ç–æ—Ç –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!');
                    return;
                }

                currentUser = user;
                currentRole = 'buyer';
                
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('userInfo').style.display = 'block';
                document.getElementById('currentUser').textContent = `üë§ ${user.username}${user.isAdmin ? ' üëë' : ''}`;
                document.getElementById('balanceDisplay').style.display = 'flex';
                document.getElementById('userBalance').textContent = user.balance || 0;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∞–¥–º–∏–Ω–∞ –µ—Å–ª–∏ –∞–¥–º–∏–Ω
                const adminRoleBtn = document.getElementById('adminRoleBtn');
                if (adminRoleBtn) {
                    adminRoleBtn.style.display = user.isAdmin ? 'block' : 'none';
                }
                
                displayProducts();
                updateUnreadBadge();
                showPage('market');
                showNotification(`‚úÖ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user.username}!`);
            } else {
                alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!');
            }
        }

        function logout() {
            currentUser = null;
            currentChatUser = null;
            
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('userInfo').style.display = 'none';
            document.getElementById('sellerPanel').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('balanceDisplay').style.display = 'none';
            
            displayProducts();
            showPage('market');
            showNotification('üëã –í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
        }

        function setRole(role) {
            currentRole = role;
            
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase().includes(role)) {
                    btn.classList.add('active');
                }
            });
            
            document.getElementById('sellerPanel').style.display = role === 'seller' ? 'block' : 'none';
            document.getElementById('adminPanel').style.display = (role === 'admin' && isAdmin()) ? 'block' : 'none';
            
            if (role === 'admin' && isAdmin()) {
                updateAdminPanel();
            }
        }

        function register() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (!username || !password) {
                alert('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }

            if (users.find(user => user.username === username)) {
                alert('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
                return;
            }

            const user = {
                id: Date.now(),
                username,
                password,
                isAdmin: false,
                role: 'user',
                balance: 0,
                registered: new Date().toLocaleString(),
                banned: false
            };

            users.push(user);
            localStorage.setItem('users', JSON.stringify(users));
            alert('‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –í–∞—à –±–∞–ª–∞–Ω—Å: 0 67 Coin');
        }

        // ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø =====
        function showPage(page) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('marketPage').style.display = 'none';
            document.getElementById('chatsPage').style.display = 'none';
            
            if (page === 'market') {
                document.getElementById('marketPage').style.display = 'block';
                displayProducts();
            } else if (page === 'chats') {
                document.getElementById('chatsPage').style.display = 'block';
                loadDialogs();
                
                if (currentChatUser) {
                    loadChat(currentChatUser.id);
                } else {
                    document.getElementById('chatWith').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç';
                    document.getElementById('chatInputArea').style.display = 'none';
                    document.getElementById('chatPlaceholder').style.display = 'flex';
                    document.getElementById('chatMessages').innerHTML = '';
                }
            }
        }

        // ===== –ê–í–¢–û–í–•–û–î –î–õ–Ø –ê–î–ú–ò–ù–ê =====
        function autoLoginAdmin() {
            const admin = users.find(u => u.username === 'ultra67turbo');
            if (admin) {
                setTimeout(() => {
                    currentUser = admin;
                    currentRole = 'admin';
                    
                    document.getElementById('loginForm').style.display = 'none';
                    document.getElementById('userInfo').style.display = 'block';
                    document.getElementById('currentUser').textContent = `üë§ ${admin.username} üëë`;
                    document.getElementById('balanceDisplay').style.display = 'flex';
                    document.getElementById('userBalance').textContent = admin.balance || 100000;
                    
                    const adminRoleBtn = document.getElementById('adminRoleBtn');
                    if (adminRoleBtn) {
                        adminRoleBtn.style.display = 'block';
                    }
                    
                    displayProducts();
                    updateUnreadBadge();
                    showPage('market');
                    showNotification('üëë –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä!');
                }, 500);
            }
        }

        // ===== –ó–ê–ü–£–°–ö =====
        window.onload = function() {
            displayProducts();
            autoLoginAdmin();
        };
    </script>
</body>
</html>